<!-- This file displays the animated SVG link to the GitHub repository 
in the top right corner -->


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mitiq.cdr.clifford_training_data &#8212; Mitiq 0.14.0dev documentation</title>
    
    <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/styles/pydata-sphinx-theme.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    
    <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/mitiq-logo.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../readme.html">
  <a href="https://github.com/unitaryfund/mitiq">
  </a>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../guide/guide.html">
  Users Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../examples/examples.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../apidoc.html">
  API-doc
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../toc_contributing.html">
  Contributing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../changelog.html">
  Changelog
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../zz_bibliography.html">
  References
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
    
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for mitiq.cdr.clifford_training_data</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2021 Unitary Fund</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;Functions for mapping circuits to (near) Clifford circuits.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">cirq</span>
<span class="kn">from</span> <span class="nn">cirq.circuits</span> <span class="kn">import</span> <span class="n">Circuit</span>

<span class="kn">from</span> <span class="nn">mitiq.interface</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">accept_any_qprogram_as_input</span><span class="p">,</span>
    <span class="n">atomic_one_to_many_converter</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Z gates with these angles/exponents are Clifford gates.</span>
<span class="n">_CLIFFORD_EXPONENTS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">_CLIFFORD_ANGLES</span> <span class="o">=</span> <span class="p">[</span><span class="n">exponent</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">exponent</span> <span class="ow">in</span> <span class="n">_CLIFFORD_EXPONENTS</span><span class="p">]</span>


<div class="viewcode-block" id="generate_training_circuits"><a class="viewcode-back" href="../../../apidoc.html#mitiq.cdr.clifford_training_data.generate_training_circuits">[docs]</a><span class="nd">@atomic_one_to_many_converter</span>
<span class="k">def</span> <span class="nf">generate_training_circuits</span><span class="p">(</span>
    <span class="n">circuit</span><span class="p">:</span> <span class="n">Circuit</span><span class="p">,</span>
    <span class="n">num_training_circuits</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">fraction_non_clifford</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">method_select</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
    <span class="n">method_replace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;closest&quot;</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Circuit</span><span class="p">]:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Returns a list of (near) Clifford circuits obtained by replacing (some)</span>
<span class="sd">    non-Clifford gates in the input circuit by Clifford gates.</span>

<span class="sd">    The way in which non-Clifford gates are selected to be replaced is</span>
<span class="sd">    determined by ``method_select`` and ``method_replace``.</span>

<span class="sd">    In the Clifford Data Regression (CDR) method [Czarnik2020]_, data</span>
<span class="sd">    generated from these circuits is used as a training set to learn the</span>
<span class="sd">    effect of noise.</span>

<span class="sd">    Args:</span>
<span class="sd">        circuit: A circuit of interest assumed to be compiled into the gate</span>
<span class="sd">            set {Rz, sqrt(X), CNOT}, or such that all the non-Clifford gates</span>
<span class="sd">            are contained in the Rz rotations.</span>
<span class="sd">        num_training_circuits: Number of circuits in the returned training set.</span>
<span class="sd">        fraction_non_clifford: The (approximate) fraction of non-Clifford</span>
<span class="sd">            gates in each returned circuit.</span>
<span class="sd">        method_select: Method by which non-Clifford gates are selected to be</span>
<span class="sd">            replaced by Clifford gates. Options are &#39;uniform&#39; or &#39;gaussian&#39;.</span>
<span class="sd">        method_replace: Method by which selected non-Clifford gates are</span>
<span class="sd">            replaced by Clifford gates. Options are &#39;uniform&#39;, &#39;gaussian&#39; or</span>
<span class="sd">            &#39;closest&#39;.</span>
<span class="sd">        random_state: Seed for sampling.</span>
<span class="sd">        kwargs: Available keyword arguments are:</span>
<span class="sd">            - sigma_select (float): Width of the Gaussian distribution used for</span>
<span class="sd">            ``method_select=&#39;gaussian&#39;``.</span>
<span class="sd">            - sigma_replace (float): Width of the Gaussian distribution used</span>
<span class="sd">            for ``method_replace=&#39;gaussian&#39;``.</span>

<span class="sd">    .. [Czarnik2020] : Piotr Czarnik, Andrew Arramsmith, Patrick Coles,</span>
<span class="sd">        Lukasz Cincio, &quot;Error mitigation with Clifford quantum circuit</span>
<span class="sd">        data,&quot; (https://arxiv.org/abs/2005.10189).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">random_state</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">random_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

    <span class="c1"># Find the non-Clifford operations in the circuit.</span>
    <span class="n">operations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">circuit</span><span class="o">.</span><span class="n">all_operations</span><span class="p">()))</span>
    <span class="n">non_clifford_indices_and_ops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">op</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">operations</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cirq</span><span class="o">.</span><span class="n">has_stabilizer_effect</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_clifford_indices_and_ops</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">circuit</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_training_circuits</span>

    <span class="n">non_clifford_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">non_clifford_indices_and_ops</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">non_clifford_ops</span> <span class="o">=</span> <span class="n">non_clifford_indices_and_ops</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Replace (some of) the non-Clifford operations.</span>
    <span class="n">near_clifford_circuits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_training_circuits</span><span class="p">):</span>
        <span class="n">new_ops</span> <span class="o">=</span> <span class="n">_map_to_near_clifford</span><span class="p">(</span>
            <span class="n">non_clifford_ops</span><span class="p">,</span>
            <span class="n">fraction_non_clifford</span><span class="p">,</span>
            <span class="n">method_select</span><span class="p">,</span>
            <span class="n">method_replace</span><span class="p">,</span>
            <span class="n">random_state</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">operations</span><span class="p">[</span><span class="n">non_clifford_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_ops</span>
        <span class="n">near_clifford_circuits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Circuit</span><span class="p">(</span><span class="n">operations</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">near_clifford_circuits</span></div>


<div class="viewcode-block" id="is_clifford"><a class="viewcode-back" href="../../../apidoc.html#mitiq.cdr.clifford_training_data.is_clifford">[docs]</a><span class="nd">@accept_any_qprogram_as_input</span>
<span class="k">def</span> <span class="nf">is_clifford</span><span class="p">(</span><span class="n">circuit</span><span class="p">:</span> <span class="n">Circuit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns True if the input argument is Clifford, else False.</span>

<span class="sd">    Args:</span>
<span class="sd">        circuit: A single operation, list of operations, or circuit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
        <span class="n">cirq</span><span class="o">.</span><span class="n">has_stabilizer_effect</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">circuit</span><span class="o">.</span><span class="n">all_operations</span><span class="p">()</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="count_non_cliffords"><a class="viewcode-back" href="../../../apidoc.html#mitiq.cdr.clifford_training_data.count_non_cliffords">[docs]</a><span class="nd">@accept_any_qprogram_as_input</span>
<span class="k">def</span> <span class="nf">count_non_cliffords</span><span class="p">(</span><span class="n">circuit</span><span class="p">:</span> <span class="n">Circuit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns the number of non-Clifford operations in the circuit. Assumes</span>
<span class="sd">    the circuit consists of only Rz, Rx, and CNOT operations.</span>

<span class="sd">    Args:</span>
<span class="sd">        circuit: Circuit to count the number of non-Clifford operations in.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
        <span class="ow">not</span> <span class="n">cirq</span><span class="o">.</span><span class="n">has_stabilizer_effect</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">circuit</span><span class="o">.</span><span class="n">all_operations</span><span class="p">()</span>
    <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_map_to_near_clifford</span><span class="p">(</span>
    <span class="n">non_clifford_ops</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Operation</span><span class="p">],</span>
    <span class="n">fraction_non_clifford</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">method_select</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
    <span class="n">method_replace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;closest&quot;</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Operation</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Returns the list of non-Clifford operations with some of these replaced</span>
<span class="sd">    by Clifford operations.</span>

<span class="sd">    Args:</span>
<span class="sd">        non_clifford_ops: A sequence of non-Clifford operations.</span>
<span class="sd">        fraction_non_clifford: The (approximate) fraction of non-Clifford</span>
<span class="sd">            operations in the returned list.</span>
<span class="sd">        method_select: The way in which the non-Clifford gates are selected to</span>
<span class="sd">            be replaced by Clifford gates. Options are &#39;uniform&#39; or &#39;gaussian&#39;.</span>
<span class="sd">        method_replace: The way in which selected non-Clifford gates are</span>
<span class="sd">            replaced by Clifford gates. Options are &#39;uniform&#39;, &#39;gaussian&#39; or</span>
<span class="sd">            &#39;closest&#39;.</span>
<span class="sd">        random_state: Seed for sampling.</span>
<span class="sd">        kwargs: Additional options for selection / replacement methods.</span>
<span class="sd">            sigma_select (float): Width of the Gaussian distribution used for</span>
<span class="sd">                ``method_select=&#39;gaussian&#39;``.</span>
<span class="sd">            sigma_replace (float): Width of the Gaussian distribution used for</span>
<span class="sd">                ``method_replace=&#39;gaussian&#39;``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sigma_select</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sigma_select&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">sigma_replace</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sigma_replace&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Select (indices of) operations to replace.</span>
    <span class="n">indices_of_selected_ops</span> <span class="o">=</span> <span class="n">_select</span><span class="p">(</span>
        <span class="n">non_clifford_ops</span><span class="p">,</span>
        <span class="n">fraction_non_clifford</span><span class="p">,</span>
        <span class="n">method_select</span><span class="p">,</span>
        <span class="n">sigma_select</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Replace selected operations.</span>
    <span class="n">clifford_ops</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Operation</span><span class="p">]</span> <span class="o">=</span> <span class="n">_replace</span><span class="p">(</span>
        <span class="p">[</span><span class="n">non_clifford_ops</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_of_selected_ops</span><span class="p">],</span>
        <span class="n">method_replace</span><span class="p">,</span>
        <span class="n">sigma_replace</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Return sequence of (near) Clifford operations.</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Operation</span><span class="p">],</span> <span class="n">clifford_ops</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_of_selected_ops</span>
        <span class="k">else</span> <span class="n">op</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">non_clifford_ops</span><span class="p">)</span>
    <span class="p">]</span>


<span class="k">def</span> <span class="nf">_select</span><span class="p">(</span>
    <span class="n">non_clifford_ops</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Operation</span><span class="p">],</span>
    <span class="n">fraction_non_clifford</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
    <span class="n">sigma</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Returns indices of non-Clifford operations selected (to be replaced)</span>
<span class="sd">    according to some method.</span>

<span class="sd">    Args:</span>
<span class="sd">        non_clifford_ops: Sequence of non-Clifford operations.</span>
<span class="sd">        fraction_non_clifford: fraction of non-Clifford gates to change.</span>
<span class="sd">        method: {&#39;uniform&#39;, &#39;gaussian&#39;} method to use to select Clifford gates</span>
<span class="sd">                to replace.</span>
<span class="sd">        sigma: width of probability distribution used in selection</span>
<span class="sd">                      of non-Clifford gates to replace, only has effect if</span>
<span class="sd">                      method_select = &#39;gaussian&#39;.</span>
<span class="sd">        random_state: Random state for sampling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">random_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span>

    <span class="n">num_non_cliff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_clifford_ops</span><span class="p">)</span>
    <span class="n">num_to_replace</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">fraction_non_clifford</span> <span class="o">*</span> <span class="n">num_non_cliff</span><span class="p">))</span>

    <span class="c1"># Get the distribution for how to select operations.</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">:</span>
        <span class="n">distribution</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">num_non_cliff</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_non_cliff</span><span class="p">,))</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;gaussian&quot;</span><span class="p">:</span>
        <span class="n">non_clifford_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">op</span><span class="o">.</span><span class="n">gate</span><span class="o">.</span><span class="n">exponent</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># type: ignore</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">non_clifford_ops</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="n">_angle_to_proximity</span><span class="p">(</span><span class="n">non_clifford_angles</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">distribution</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Arg `method_select` must be &#39;uniform&#39; or &#39;gaussian&#39; but was &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Select (indices of) non-Clifford operations to replace.</span>
    <span class="n">selected_indices</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">,</span> <span class="n">random_state</span><span class="p">)</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
        <span class="nb">range</span><span class="p">(</span><span class="n">num_non_cliff</span><span class="p">),</span>
        <span class="n">num_non_cliff</span> <span class="o">-</span> <span class="n">num_to_replace</span><span class="p">,</span>
        <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">p</span><span class="o">=</span><span class="n">distribution</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">selected_indices</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span>
    <span class="n">non_clifford_ops</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Operation</span><span class="p">],</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
    <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Operation</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Function that takes the non-Clifford angles and replacement and</span>
<span class="sd">    selection specifications, returning the projected angles according to a</span>
<span class="sd">    specific method.</span>

<span class="sd">    Args:</span>
<span class="sd">        non_clifford_ops: array of non-Clifford angles.</span>
<span class="sd">        method: {&#39;uniform&#39;, &#39;gaussian&#39;, &#39;closest&#39;} method to use</span>
<span class="sd">                        to replace selected non-Clifford gates.</span>
<span class="sd">        sigma: width of probability distribution used in replacement</span>
<span class="sd">                       of selected non-Clifford gates, only has effect if</span>
<span class="sd">                       method_replace = &#39;gaussian&#39;.</span>
<span class="sd">        random_state: Seed for sampling.</span>
<span class="sd">    Returns:</span>
<span class="sd">        rz_non_clifford_replaced: the selected non-Clifford gates replaced by a</span>
<span class="sd">                               Clifford according to some method.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If argument &#39;method_replace&#39; is not either &#39;closest&#39;,</span>
<span class="sd">        &#39;uniform&#39; or &#39;gaussian&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">random_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span>

    <span class="c1"># TODO: Update these functions to act on operations instead of angles.</span>
    <span class="n">non_clifford_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">gate</span><span class="o">.</span><span class="n">exponent</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">non_clifford_ops</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;closest&quot;</span><span class="p">:</span>
        <span class="n">clifford_angles</span> <span class="o">=</span> <span class="n">_closest_clifford</span><span class="p">(</span><span class="n">non_clifford_angles</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">:</span>
        <span class="n">clifford_angles</span> <span class="o">=</span> <span class="n">_random_clifford</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">non_clifford_angles</span><span class="p">),</span> <span class="n">random_state</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;gaussian&quot;</span><span class="p">:</span>
        <span class="n">clifford_angles</span> <span class="o">=</span> <span class="n">_probabilistic_angle_to_clifford</span><span class="p">(</span>
            <span class="n">non_clifford_angles</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">random_state</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Arg `method_replace` must be &#39;closest&#39;, &#39;uniform&#39;, or &#39;gaussian&#39;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; but was </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># TODO: Write function to replace the angles in a list of operations?</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">clifford_angles</span><span class="p">,</span>
            <span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">qubits</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">non_clifford_ops</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">]</span>


<span class="k">def</span> <span class="nf">_random_clifford</span><span class="p">(</span>
    <span class="n">num_angles</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">random_state</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns an array of Clifford angles chosen uniformly at random.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_angles: Number of Clifford angles to return in array.</span>
<span class="sd">        random_state: Random state for sampling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">random_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">_CLIFFORD_ANGLES</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_angles</span><span class="p">)]</span>
    <span class="p">)</span>


<span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
<span class="k">def</span> <span class="nf">_closest_clifford</span><span class="p">(</span><span class="n">angles</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns the nearest Clifford angles to the input angles.</span>

<span class="sd">    Args:</span>
<span class="sd">        non_Clifford_ops: Non-Clifford opperations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ang_scaled</span> <span class="o">=</span> <span class="n">angles</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># if just one min value, return the corresponding nearest cliff.</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="nb">abs</span><span class="p">((</span><span class="n">ang_scaled</span> <span class="o">/</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
        <span class="ow">and</span> <span class="nb">abs</span><span class="p">((</span><span class="n">ang_scaled</span> <span class="o">/</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">ang_scaled</span> <span class="o">/</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">))</span>
    <span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ang_scaled</span><span class="p">))</span> <span class="o">%</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="n">_CLIFFORD_ANGLES</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="c1"># If equidistant between two Clifford angles, randomly choose one.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ang_scaled</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ang_scaled</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">index_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_CLIFFORD_ANGLES</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>


<span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
<span class="k">def</span> <span class="nf">_is_clifford_angle</span><span class="p">(</span>
    <span class="n">angles</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Function to check if a given angle is Clifford.</span>

<span class="sd">    Args:</span>
<span class="sd">        angles: rotation angle in the Rz gate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="n">angles</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">closest_clifford_angle</span> <span class="o">=</span> <span class="n">_closest_clifford</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">closest_clifford_angle</span> <span class="o">-</span> <span class="n">angles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_angle_to_proximities</span><span class="p">(</span><span class="n">angle</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Returns probability distribution based on distance from angles to</span>
<span class="sd">    Clifford gates.</span>

<span class="sd">    Args:</span>
<span class="sd">        angle: angle to form probability distribution.</span>

<span class="sd">    Returns:</span>
<span class="sd">        discrete value of probability distribution calculated from</span>
<span class="sd">        exp(-(diff/sigma)^2) where diff is the distance from each angle and the</span>
<span class="sd">        Clifford gates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s_matrix</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">unitary</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
    <span class="n">rz_matrix</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">unitary</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">angle</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
    <span class="c1"># TODO: Update loop / if.</span>
    <span class="n">dists</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">exponent</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exponent</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exponent</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rz_matrix</span> <span class="o">-</span> <span class="n">s_matrix</span><span class="o">**</span><span class="n">exponent</span><span class="p">)</span>
        <span class="n">dists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">diff</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">dists</span>


<span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
<span class="k">def</span> <span class="nf">_angle_to_proximity</span><span class="p">(</span><span class="n">angle</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns probability distribution based on distance from angles to</span>
<span class="sd">    Clifford gates.</span>

<span class="sd">    Args:</span>
<span class="sd">        angle: angle to form probability distribution.</span>

<span class="sd">    Returns:</span>
<span class="sd">        discrete value of probability distribution calculated from</span>
<span class="sd">        exp(-(dist/sigma)^2) where dist = sum(dists) is the</span>
<span class="sd">        sum of distances from each Clifford gate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dists</span> <span class="o">=</span> <span class="n">_angle_to_proximities</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span>


<span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
<span class="k">def</span> <span class="nf">_probabilistic_angle_to_clifford</span><span class="p">(</span>
    <span class="n">angles</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns a Clifford angle sampled from the distribution</span>

<span class="sd">                        prob = exp(-(dist/sigma)^2)</span>

<span class="sd">    where dist is the Frobenius norm from the 4 clifford angles and the gate</span>
<span class="sd">    of interest.</span>

<span class="sd">    Args:</span>
<span class="sd">        angles: Non-Clifford angles.</span>
<span class="sd">        sigma: Width of probability distribution.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dists</span> <span class="o">=</span> <span class="n">_angle_to_proximities</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>

    <span class="n">cliff_ang</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
        <span class="n">_CLIFFORD_ANGLES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">cliff_ang</span>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          
    
<!--
    Adds link to GitHub repository as an animated SVG in the top-right corner
    of the documentation.
    
    Source: github-corners https://github.com/tholman/github-corners

    License:
    The MIT License (MIT)

    Copyright (c) 2016 Tim Holman

    Permission is hereby granted, free of charge, to any person obtaining a
    copy of this software and associated documentation files (the "Software"),
    to deal in the Software without restriction, including without limitation 
    the rights to use, copy, modify, merge, publish, distribute, sublicense, 
    and/or sell copies of the Software, and to permit persons to whom the 
    Software is furnished to do so, subject to the following conditions:
    
    The above copyright notice and this permission notice shall be included in 
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
    DEALINGS IN THE SOFTWARE.
-->
<a href="https://github.com/unitaryfund/mitiq" class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 60; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>



      </div>
    </div>
  
    <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020, Tech Team @ Unitary Fund.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>